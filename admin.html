<!DOCTYPE html>
<html lang="en">
    <head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title>Document</title>
		
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.11/web3.min.js" integrity="sha512-6lf28FmolQdo4ap44cXw7j+thYEZzS1/kXxDkX1ppO//SHCageBS1HmYdqkkL819WfGtQ+7TE+uXEwsxjJXEKQ==" crossorigin="anonymous"></script> -->
		
</script>
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
		<link rel="stylesheet" type="text/css" href="index.css">
    </head>
	
    <body > 
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<a class="navbar-brand" href="#">Rewards Hub</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" 
			data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" 
			aria-expanded="false" aria-label="Toggle navigation">
			  <span class="navbar-toggler-icon"></span>
			</button>
		  
			<div class="collapse navbar-collapse" id="navbarSupportedContent">
			  <ul class="navbar-nav mr-auto">
				<li class="nav-item active">
				  <a class="nav-link" href="admin.html">Admin <span class="sr-only">(current)</span> </a>
				</li>
				<li class="nav-item">
				  <a class="nav-link" href="user.html">User</a>
				</li>
			  </ul>
			</div>
			<div id="prepare">
				<button class="btn btn-primary" id="btn-connect">
				  Connect wallet
				</button>
			  </div>
	
			  <div id="connected" style="display: none">	
				<button class="btn btn-primary" id="btn-disconnect">
				  Disconnect wallet
				</button>	
			  </div>
			<div id="selected-account"></div> 
		  </nav>
		  <div class="container">
		  <div class="row">
			<h1 class="col-md-12 text-center"> REWARDS HUB ADMIN FLOW </h1>
			<div class="col-md-6">
				<h2 class="row col-lg-12" >POOL CREATION</h2>
					<div class="form-group row col-lg-12">
						<input class="col-lg-8 form-control" id="pool-token" type="text" placeholder="Tokens for pool creation"/>
						<button class="col-lg-4 form-control btn btn-warning" id="pool-create">Create</button>  
						<div class="col-lg-12 alert alert-light pool-info" role="alert"></div>			
					</div>
				<h2 class="row col-lg-12" >MAX TOKENS PER TRANSACTION</h2>
					<div class="form-group row col-lg-12">
						<input class="col-lg-8 form-control" id="max-txion-token" type="text" placeholder="Max tokens per transaction"/>
						<button class="col-lg-4 form-control btn btn-success" id="txion-btn">Set</button>  
						<div class="col-lg-12 alert alert-success txion-success" role="alert"></div>			
					</div>
					
					<h3 class="row col-lg-12" >MAX TOKENS PER DAY</h3>
					<div class="form-group row col-lg-12">
						<input class="col-lg-8 form-control" id="max-day-token" type="text" placeholder="Max tokens per day"/>
						<button class="col-lg-4 form-control btn btn-dark" id="day-btn">Set</button> 
						<div class="col-lg-12 alert alert-dark day-success" role="alert"></div>			
					</div><hr/>
			</div>
			<div class="col-md-6">
				<h2 class="row col-lg-12" >POINTS TO TOKEN CONVERSION RATIO</h2>
					<div class="form-group row col-lg-12">
						<input class="col-lg-8 form-control" id="ratio" type="text" placeholder="Conversion ratio"/>
						<button class="col-lg-4 form-control btn btn-info" id="ratio-btn">Set</button> 
						<div class="col-lg-12 alert alert-info ratio-success" role="alert"></div>			
					</div>
				<!-- <h2 class="row col-lg-12" >MAX TOKENS PER TRANSACTION</h2>
					<div class="form-group row col-lg-12">
						<input class="col-lg-8 form-control" id="max-txion-token" type="text" placeholder="Max tokens per transaction"/>
						<button class="col-lg-4 form-control btn btn-success" id="txion-btn">Set</button> 
						<div class="col-lg-12 alert alert-success txion-success" role="alert"></div>			
					</div>
					
					<h3 class="row col-lg-12" >MAX TOKENS PER DAY</h3>
					<div class="form-group row col-lg-12">
						<input class="col-lg-8 form-control" id="max-day-token" type="text" placeholder="Max tokens per day"/>
						<button class="col-lg-4 form-control btn btn-dark" id="day-btn">Set</button>  
						<div class="col-lg-12 alert alert-dark day-success" role="alert"></div>			
					</div> -->
			</div>
		  </div>	
		</div>
</body>
	<script>
		$(document).ready(function() {
			// $(".pool-success").hide(); $(".txion-success").hide(); $(".day-success").hide();
		});
	</script>
	<script type="text/javascript" src="https://unpkg.com/web3@1.2.11/dist/web3.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/web3modal@1.9.0/dist/index.js"></script>
    <script type="text/javascript" src="https://unpkg.com/evm-chains@0.2.0/dist/umd/index.min.js"></script>
    <script type="text/javascript" src="https://unpkg.com/@walletconnect/web3-provider@1.2.1/dist/umd/index.min.js"></script>
	<script type="text/javascript" src="https://unpkg.com/fortmatic@2.0.6/dist/fortmatic.js"></script>
	<!-- This is our example code -->
	<script type="text/javascript" src="./example.js"></script>
	
	<script type="module">
		import { ethers } from "https://cdn.ethers.io/lib/ethers-5.0.esm.min.js";
		const provider = new ethers.providers.Web3Provider(window.ethereum)
		const signer = provider.getSigner()
		
		// contract details
		var rewardMgmtABI= JSON.parse('[{"inputs":[{"internalType":"uint256","name":"poolTokens","type":"uint256"}],"name":"createPool","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenToRedeem","type":"uint256"}],"name":"redeemToken","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"ratio","type":"uint256"}],"name":"setConversionRatio","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"setDayLimit","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"setTranLimit","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[],"name":"conversionRatio","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxDayToken","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"maxTransToken","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ownerBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"poolBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"userBalance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]');
		const rewardMgmtContract = new ethers.Contract('0x8B956ff88257622e2319f423Dadc9EcBc095F70e', rewardMgmtABI, provider);
		const rewardMgmtSigner = rewardMgmtContract.connect(signer);

		var tokenABI= JSON.parse('[{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"spender","type":"address"},{"name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transfer","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"from","type":"address"},{"name":"to","type":"address"},{"name":"value","type":"uint256"}],"name":"transferFrom","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"inputs":[{"name":"name","type":"string"},{"name":"symbol","type":"string"},{"name":"decimals","type":"uint8"},{"name":"totalSupply","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"name":"from","type":"address"},{"indexed":true,"name":"to","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"name":"owner","type":"address"},{"indexed":true,"name":"spender","type":"address"},{"indexed":false,"name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"constant":true,"inputs":[{"name":"owner","type":"address"},{"name":"spender","type":"address"}],"name":"allowance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"}]');
		const tokenContract = new ethers.Contract('0x190c67b37DF42B4235A39E7c3c3000C3764D8770', tokenABI, provider);
		const tokenSigner = tokenContract.connect(signer);	
		
		getTokenBalance();
		// Calling create pool function
		$(document).on("click", "#pool-create", async function(){
			var token = $("#pool-token").val();
			// var wei = parseInt(token)*1e18;
			console.log("token: "+ token);
			const tx1 = await tokenSigner.approve('0x8B956ff88257622e2319f423Dadc9EcBc095F70e', token);
			console.log("Transaction1 : " + tx1.hash);
			const tx2 = await rewardMgmtSigner.createPool(token);			
			$(".pool-success").text(tx2.hash);
			console.log("Transaction2 : " + tx2.hash);
			
		});

		$(document).on("click", "#txion-btn", async function(){
			var token = $("#max-txion-token").val();
			// var wei = parseInt(token)*1e18;
			console.log("token: "+ token);
			
			const tx = await rewardMgmtSigner.setTranLimit(token);			
			$(".txion-success").text(tx.hash);
			console.log("Transaction : " + tx.hash);
			
		});

		$(document).on("click", "#day-btn", async function(){
			var token = $("#max-day-token").val();
			// var wei = parseInt(token)*1e18;
			console.log("token: "+ token);
		
			const tx = await rewardMgmtSigner.setDayLimit(token);			
			$(".day-success").text(tx.hash);
			console.log("Transaction : " + tx.hash);
		});

		$(document).on("change", "#ratio", async function(){
			var value = $("#ratio").val();
			// var wei = parseInt(token)*1e18;
			console.log("Ratio value: "+ value);
		    var reflect = "For 100 tokens you will get " + (100* value)/100 +" tokens";
			$(".ratio-success").text(reflect);
			console.log("ratio : " + value);
		});

		$(document).on("click", "#ratio-btn", async function(){
			var value = $("#ratio").val();
			// var wei = parseInt(token)*1e18;
			console.log("Ratio value: "+ value);
		
			const tx = await rewardMgmtSigner.setConversionRatio(value);			
			$(".ratio-success").text(tx.hash);
			console.log("ratio-success : " + tx.hash);
		});

		async function getTokenBalance() {
			const ownerBalance = await rewardMgmtSigner.ownerBalance();
			$(".owner-bal").text(ownerBalance);
			console.log("ownerBalance : " + ownerBalance);

		    const poolBalance = await rewardMgmtSigner.poolBalance();
			$(".pool-info").text("Currently " +poolBalance+ " MIXS tokens in pool");
			console.log("poolBalance : " + poolBalance);

			const maxDayToken = await rewardMgmtSigner.maxDayToken();
			$(".day-success").text("User can transfer only " +maxDayToken+ " tokens per day");
			console.log("maxDayToken : " + maxDayToken);
			$("#max-day-token").val(maxDayToken);

			const maxTransToken = await rewardMgmtSigner.maxTransToken();
			$(".txion-success").text("User can transfer only " +maxTransToken+ " tokens per transactions");
			console.log("maxTransToken : " + maxTransToken);
			$("#max-txion-token").val(maxTransToken);

			const conversionRatio = await rewardMgmtSigner.conversionRatio();
			$(".ratio-success").text("User will get " +conversionRatio+ "% of tokens for given points");
			console.log("conversionRatio : " + conversionRatio);
			$("#ratio").val(conversionRatio);
		}
		
	</script>
</html>